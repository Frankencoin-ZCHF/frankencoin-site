---
/* src/components/layout/Section.astro
   Props:
     - id?: string
     - variant?: "plain" | "accent" (default "plain")
     - width?: "narrow" | "content" | "wide" | "full" (default "content")
     - align?: "left" | "center" (default "left")
     - pad?: "sm" | "md" | "lg" (default "md")
     - layout?: "default" | "split" | "feature" (default "default")
     - contentPosition?: "left" | "right" (default "right")
     - imgUrl?: string (optional background image for the whole section)
   
   Slots:
     - default: Main content
     - aside: Secondary content (for split and feature layouts)
*/
import Container from "./Container.astro";

interface Props {
  id?: string;
  variant?: "plain" | "accent";
  width?: "narrow" | "content" | "wide" | "full";
  align?: "left" | "center";
  pad?: "sm" | "md" | "lg";
  layout?: "default" | "split" | "feature";
  eyebrow?: string;
  title?: string;
  subtitle?: string;
  contentPosition?: "left" | "right";
  headerPosition?: "items-center" | "items-start";
  imgUrl?: string;
  /** Optional classes for the absolutely-positioned bottom slot */
  bottomClass?: string;
  /** Optional Tailwind margin classes applied to the root section (e.g., "my-8 mt-12") */
  margin?: string;
  /** How the bottom slot is positioned: absolute (overlays) or static (flows after content). Default: "absolute" */
  bottomPosition?: "absolute" | "static";
  /** Tailwind classes to reserve space at the bottom (e.g., "pb-24") when bottomPosition is "absolute" */
  bottomSpacing?: string;
  /** Additional classes applied directly to the root <section> (escape hatch) */
  className?: string;
}

const {
  id,
  variant = "plain",
  width = "content",
  align = "left",
  headerPosition = "items-center",
  pad = "md",
  layout = "default",
  eyebrow,
  title,
  subtitle,
  contentPosition = "right",
  imgUrl,
  bottomClass,
  margin = "",
  bottomPosition = "absolute",
  bottomSpacing = "",
  className = "",
} = Astro.props as Props;

const pads = {
  sm: "py-[calc(var(--spacing-l)*2)]", // ~32px si --spacing-l=16px
  md: "py-[calc(var(--spacing-l)*4)]", // ~64px
  lg: "py-[calc(var(--spacing-l)*6)]", // ~96px
}[pad];

const bg =imgUrl?.length   ? "bg-transparent" : 
  variant === "accent"
    ? "bg-[var(--color-gray-10)]"
    : "bg-[var(--color-white)]";

// Optional background image support
const hasBgImage = typeof imgUrl === "string" && imgUrl.length > 0;
const bgImageClasses = hasBgImage ? "bg-cover bg-center bg-no-repeat" : "";
const sectionStyle = hasBgImage ? `background-image: url('${imgUrl}')` : undefined;

const textAlign = align === "center" ? "text-center" : "text-left";

// Layout classes
const isContentLeft = contentPosition === "left";
const flexOrder = isContentLeft ? "md:flex-row-reverse" : "md:flex-row";

const mainBasis = isContentLeft ? "md:basis-4/5" : "md:basis-1/5";
const asideBasis = isContentLeft ? "md:basis-1/5" : "md:basis-4/5"; 
---

<section id={id} class={`${pads} ${bg} ${bgImageClasses} relative overflow-unset  z-0 ${margin} ${bottomPosition === 'absolute' ? bottomSpacing : ''} ${className} w-[100%]` } style={sectionStyle}>
  <div class="relative z-10">
    <Container width={width} id={id}>
    {layout === "default" && (
      <div class={`${textAlign}`}>
        <div class="flex flex-col gap-2 items-center mb-8">
          {eyebrow && <h3 class="ty-subtitle">{eyebrow.toUpperCase()}</h3>}
          {title && <h1 class="ty-large-title ">{title}</h1>}
          {subtitle && <h2 class="ty-body-1">{subtitle}</h2>}
        </div>
        <slot />
      </div>
    )}

    {layout === "split" && (
      <div class={`flex flex-col ${flexOrder} gap-8 md:gap-12 ${headerPosition}`}>
        <!-- Contenido principal -->
        <div class={`${mainBasis} space-y-6`}>
          {eyebrow && <h3 class="ty-subtitle mb-0">{eyebrow.toUpperCase()}</h3>}
          {title && <h1 class="ty-large-title">{title}</h1>}
          {subtitle && <h2 class="ty-body-1">{subtitle}</h2>}
          <slot />
        </div>
        
        <div class={`${asideBasis} w-full`}>
          <slot name="aside" />
        </div>
      </div>
    )}

    {layout === "feature" && (
      <div class="space-y-8">
        <!-- Header centrado -->
        <div class="text-center space-y-4">
          {eyebrow && <h3 class="ty-subtitle">{eyebrow.toUpperCase()}</h3>}
          {title && <h1 class="ty-large-title">{title}</h1>}
          {subtitle && <h2 class="ty-body-1">{subtitle}</h2>}
        </div>
        
        <!-- Contenido con aside -->
        <div class={`flex flex-col ${flexOrder} gap-8 md:gap-12 items-center`}>
          <!-- Contenido principal -->
          <div class={`${mainBasis}`}>
            <slot />
          </div>
          
          <!-- Contenido secundario -->
          <div class={` ${asideBasis}`}>
            <slot name="aside" />
          </div>
        </div>
      </div>
    )}
  
    </Container>
    
  </div>
  {bottomPosition === 'absolute' ? (
    <>
      <div class={`${bottomClass ?? ''} md:hidden absolute inset-x-0 top-[90%] z-20 w-full`}>
        <slot name="bottom" />
      </div>
      <div class={` hidden md:block absolute inset-x-0 top-[90%] z-20 ${bottomClass ?? ''}`}>
        <slot name="bottom" />
      </div>
    </>
  ) : (
    <div class={`${bottomClass ?? ''}`}>
      <slot name="bottom" />
    </div>
  )}
</section>
