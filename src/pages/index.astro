---
import Section from "../components/Layout/Section.astro";
import SectionHeader from "../components/Layout/SectionHeader.astro";
import Base from "../layouts/Base.astro";
import index from "../content/index.json";
import FeaturesContainer from "../components/FeaturesContainer/FeaturesContainer.astro";
import TabMenu from "../components/TabsMenu/TabMenu.astro";
import FoundationContainer from "../components/FoundationContainer/FoundationContainer.astro";
import TrustSecurityContainer from "../components/TrustSecurityContainer/TrustSecurityContainer.astro";
import FAQContainer from "../components/FAQContainer/FAQContainer.astro";
import AssetsContainer from "../components/AssetsContainer/AssetsContainer.astro";
import FlexStack from "../components/Layout/FlexStack.astro";
import BadgeContainer from "../components/BadgeContainer/BadgeContainer.astro";
import ExplanationCardsContainer from "../components/ExplanationCardsContainer/ExplanationCardsContainer.astro";
import MediaArticlesContainer from "../components/MediaArticlesContainer/MediaArticlesContainer.astro";
import VideoCarouselContainer from "../components/VideoCarouselContainer/VideoCarouselContainer.astro";

async function getFrankencoinInfo() {
  try {
    let response = await fetch(
      "https://api.frankencoin.com/ecosystem/frankencoin/info"
    );
    if (!response.ok) throw new Error("Failed to fetch quote");
    return response.json();
  } catch (error) {
    console.error("Error fetching data:", error);
    return null;
  }
}

const frankencoinInfo = await getFrankencoinInfo();

type StatMeta = { label?: string; unit?: string; href?: string };

function findStat(id: string): StatMeta {
  return ((index.stats ?? []).find((s: any) => s.id === id) || {}) as StatMeta;
}

function formatAmount(n: number) {
  if (typeof n !== "number" || Number.isNaN(n)) return "0";
  return n.toFixed(0).replace(/\d{1,3}(?=(\d{3})+(?!\d))/g, "$&'");
}

const s2 = findStat("totalValueLocked");
const s1 = findStat("totalSupply");
const s3 = findStat("fpsMarketCap");

const stats: Option[] = frankencoinInfo
  ? [
            {
        label: s1.label ?? "Money circulating",
        value: formatAmount(frankencoinInfo.token?.supply ?? 0),
        unit: s1.unit,
        href: s1.href,
      },
      {
        label: s2.label ?? "Collateral value",
        value: formatAmount(frankencoinInfo.tvl?.chf ?? 0),
        unit: s2.unit,
        href: s2.href
      },

      {
        value: "Swiss Law & MiCAR",
        label: "Fully Compliant",
        href: "/#trust-security",
      },
    ]
  : [];
---


---

<Base>
  <Section
    id="main-page-header"
    variant="accent"
    align="center"
    pad="xxs"
    imgUrl={index.hero.image}
  >
    <div class="flex flex-col gap-8 items-start md:my-60 mb-40">
      <SectionHeader
        eyebrow={index.hero.eyebrow}
        title={index.hero.title}
        subtitle={index.hero.subtitle}
        margin="none"
        size="display"
        align="left"
        padding="xl"
        hasSocialMedia
        cta={{
          label: index.hero.cta.label,
          href: index.hero.cta.href,
          variant: "primary",
        }}
      />
    </div>
       <FlexStack direction="col" align="center" slot="bottom" align="center">
      <BadgeContainer options={stats} />
    </FlexStack>
   
  </Section>

  <Section
    id="what-is"
    eyebrow={index.what_is.eyebrow}
    title={index.what_is.title}
    subtitle={index.what_is.subtitle}
    pad="xs"
    margin="lg:mt-20 mt-60"
  >
    <ExplanationCardsContainer cards={index.what_is.explanation} />
  </Section>

  <Section
    id="core-features"
    eyebrow={index.core_features.eyebrow}
    title={index.core_features.title}
    pad="xs"
    margin="lg:mt-20 mt-60"
  >
    <FeaturesContainer features={index.core_features.features} />
    <div class="flex justify-center mt-12">
      <a
        href="/use-cases"
        class="w-full flex items-center justify-center gap-2 bg-[var(--color-brand-deep-blue)] text-white px-6 py-3 rounded-lg ty-regular font-bold hover:bg-[var(--color-brand-swiss)] transition-colors"
      >
        <span>See more use-cases</span>
        <img src="images/Arrow.svg" loading="lazy" alt="" class="w-3 h-3 brightness-0 invert" />
      </a>
    </div>
  </Section>

  <Section
    id="how-does-it-work"
    eyebrow={index.how_does_it_work.eyebrow}
    title={index.how_does_it_work.title}
    pad="xs"
    margin="lg:mt-20 mt-60"
  >
    <ExplanationCardsContainer cards={index.how_does_it_work.explanation} />
  </Section>

    <Section
    id="foundation"
    layout="split"
    title={index.foundation.title}
    subtitle={index.foundation.description}
    contentPosition="left"
    variant="accent"
  >
    <div
      class="flex md:flex-row flex-col gap-10px items-stretch gap-8"
      slot="aside"
    >
      <img src={index.foundation.image} alt={index.foundation.imageAlt} />
    </div>
    <FoundationContainer />
  </Section>



  <Section
    id="how-it-works"
    title={index.how_it_works.title}
    subtitle={index.how_it_works.subtitle}
  >
    <div class="flex md:flex-row flex-col gap-40px items-stretch gap-8">
      <TabMenu tabs={index.how_it_works.steps} />
    </div>
  </Section>
  <Section
    id="trust-security"
    eyebrow={index.trust_security.eyebrow}
    title={index.trust_security.title}
    width="full"
  >
    <TrustSecurityContainer />
  </Section>



  <Section
    id="in-the-media"
    eyebrow={index.in_the_media.eyebrow}
    title={index.in_the_media.title}
    subtitle={index.in_the_media.subtitle}
    variant="accent"
  >
    <MediaArticlesContainer articles={index.in_the_media.articles} />
  </Section>

  <Section
    id="videos"
    eyebrow={index.videos.eyebrow}
    title={index.videos.title}
    subtitle={index.videos.subtitle}
  >
    <VideoCarouselContainer videos={index.videos.videoUrls} />
  </Section>

  <Section
    id="faq"
    title={index.faq.title}
    layout="split"
    headerPosition="items-start"
  >
    <FAQContainer faqs={index.faq} slot="aside" />
  </Section>
</Base>
