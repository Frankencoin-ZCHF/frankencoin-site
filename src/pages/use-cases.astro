---
import Section from "../components/Layout/Section.astro";
import Base from "../layouts/Base.astro";
import { getLanguageFromURL, loadContent } from "../utils/i18n";

const currentLang = getLanguageFromURL(Astro.url.pathname);
const useCases = await loadContent("use-cases", currentLang);

// Extract unique categories from use cases
const categories = ["All", ...new Set(useCases.cases.map(c => c.category))];
---

<Base>
  <Section
    id="use-cases"
    eyebrow={useCases.eyebrow}
    title={useCases.title}
    variant="plain"
  >
    <div class="max-w-4xl mx-auto mb-12 text-center">
      <p class="ty-body-1 text-[var(--color-brand-titan-gray)] leading-relaxed">
        {useCases.intro}
      </p>
    </div>

    <!-- Filter Buttons -->
    <div
      class="flex flex-wrap justify-center gap-3 mb-8"
      x-data="{
        selectedCategory: 'All',
        allCases: [],
        get filteredCases() {
          if (this.selectedCategory === 'All') return this.allCases;
          return this.allCases.filter(c => c.category === this.selectedCategory);
        },
        shuffle(array) {
          const shuffled = [...array];
          for (let i = shuffled.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
          }
          return shuffled;
        },
        init() {
          const cases = JSON.parse(this.$el.dataset.cases);
          this.allCases = this.shuffle(cases);
        }
      }"
      x-init="init()"
      data-cases={JSON.stringify(useCases.cases)}
    >
      {categories.map((category) => (
        <button
          @click={`selectedCategory = '${category}'`}
          :class={`selectedCategory === '${category}' ? 'bg-[var(--color-brand-deep-blue)] text-white' : 'bg-white text-[var(--color-brand-deep-blue)] border border-[var(--color-brand-deep-blue)]'`}
          class="px-5 py-2 rounded-full ty-regular font-bold transition-all hover:shadow-md"
        >
          {category}
        </button>
      ))}

      <!-- Use Cases Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-7xl mx-auto w-full mt-8">
        <template x-for="useCase in filteredCases" :key="useCase.title">
          <a
            :href="useCase.link"
            target="_blank"
            rel="noopener noreferrer"
            class="group bg-white rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 p-8 space-y-6 flex flex-col border border-gray-100 hover:border-[var(--color-brand-deep-blue)] relative overflow-hidden"
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 scale-95"
            x-transition:enter-end="opacity-100 scale-100"
          >
            <!-- Background gradient on hover -->
            <div class="absolute inset-0 bg-gradient-to-br from-[var(--color-brand-deep-blue)]/0 to-[var(--color-brand-swiss)]/0 group-hover:from-[var(--color-brand-deep-blue)]/5 group-hover:to-[var(--color-brand-swiss)]/5 transition-all duration-300"></div>

            <!-- Content -->
            <div class="relative flex flex-col h-full">
              <!-- Logo container -->
              <div class="flex-shrink-0 h-24 flex items-center justify-start mb-6">
                <img
                  :src="useCase.image"
                  :alt="useCase.partner"
                  class="max-h-20 max-w-[200px] object-contain filter brightness-100 group-hover:brightness-110 transition-all"
                  loading="lazy"
                />
              </div>

              <!-- Category badge -->
              <div class="mb-3">
                <span class="inline-block ty-small text-[var(--color-brand-deep-blue)] bg-[var(--color-brand-deep-blue)]/10 px-3 py-1 rounded-full uppercase tracking-wide" x-text="useCase.category"></span>
              </div>

              <!-- Text content -->
              <div class="flex-grow space-y-3">
                <h3 class="ty-big-2 text-[var(--color-brand-deep-blue)] group-hover:text-[var(--color-brand-swiss)] transition-colors" x-text="useCase.title"></h3>
                <p class="ty-body-2 text-[var(--color-brand-titan-gray)] leading-relaxed" x-text="useCase.description"></p>
              </div>

              <!-- Partner & arrow -->
              <div class="mt-6 pt-4 border-t border-gray-200 flex items-center justify-between">
                <p class="ty-regular font-bold text-[var(--color-brand-deep-blue)]" x-text="useCase.partner"></p>
                <img
                  src="images/Arrow.svg"
                  loading="lazy"
                  alt=""
                  class="w-4 h-4 transform group-hover:translate-x-1 transition-transform"
                />
              </div>
            </div>
          </a>
        </template>
      </div>
    </div>
  </Section>
</Base>
